{
  "terraform": {
    "required_providers": {
      "aws": {
        "source": "aws",
        "version": "5.94.1"
      }
    },
    "backend": {
      "s3": {
        "bucket": "dinghy-website-tf-state",
        "key": "tfstates/app-main.tfstate",
        "region": "us-east-1",
        "use_lockfile": true
      }
    }
  },
  "provider": {
    "aws": [
      {
        "default_tags": [
          {
            "tags": {
              "iac:stack-title": "Dinghy Website",
              "iac:stack-name": "dinghy-website"
            }
          }
        ],
        "region": "us-east-1"
      }
    ]
  },
  "resource": {
    "aws_cloudfront_distribution": {
      "aws_cloudfront_distribution_www": {
        "aliases": [
          "dinghy.dev"
        ],
        "restrictions": {
          "geo_restriction": {
            "restriction_type": "none",
            "locations": []
          }
        },
        "default_cache_behavior": {
          "allowed_methods": [
            "GET",
            "HEAD",
            "OPTIONS"
          ],
          "cached_methods": [
            "GET",
            "HEAD"
          ],
          "target_origin_id": "defaultOrigin",
          "compress": true,
          "viewer_protocol_policy": "redirect-to-https",
          "response_headers_policy_id": "60669652-455b-4ae9-85a4-c4c02393f86c",
          "cache_policy_id": "658327ea-f89d-4fab-a63d-7e88639e58f6"
        },
        "origin": {
          "domain_name": "${aws_s3_bucket.aws_s3_bucket_wwwv1_v1.bucket_regional_domain_name}",
          "origin_id": "defaultOrigin",
          "origin_access_control_id": "${aws_cloudfront_origin_access_control.aws_cloudfront_origin_access_control_www.id}"
        },
        "custom_error_response": [
          {
            "error_caching_min_ttl": 3600,
            "error_code": 403,
            "response_code": 404,
            "response_page_path": "/errors/404.html"
          }
        ],
        "enabled": true,
        "default_root_object": "index.html",
        "logging_config": {
          "bucket": "${aws_s3_bucket.aws_s3_bucket_logs.bucket_regional_domain_name}",
          "prefix": "log-sink/cloudfront/dinghy.dev/"
        },
        "viewer_certificate": {
          "acm_certificate_arn": "${data.aws_acm_certificate.aws_acm_certificate_dinghydev.arn}",
          "ssl_support_method": "sni-only",
          "minimum_protocol_version": "TLSv1.2_2021"
        }
      },
      "aws_cloudfront_distribution_play": {
        "aliases": [
          "play.dinghy.dev"
        ],
        "restrictions": {
          "geo_restriction": {
            "restriction_type": "none",
            "locations": []
          }
        },
        "default_cache_behavior": {
          "allowed_methods": [
            "GET",
            "HEAD",
            "OPTIONS"
          ],
          "cached_methods": [
            "GET",
            "HEAD"
          ],
          "target_origin_id": "defaultOrigin",
          "compress": true,
          "viewer_protocol_policy": "redirect-to-https",
          "response_headers_policy_id": "60669652-455b-4ae9-85a4-c4c02393f86c",
          "cache_policy_id": "658327ea-f89d-4fab-a63d-7e88639e58f6"
        },
        "origin": {
          "domain_name": "${aws_s3_bucket.aws_s3_bucket_playv1_v1.bucket_regional_domain_name}",
          "origin_id": "defaultOrigin",
          "origin_access_control_id": "${aws_cloudfront_origin_access_control.aws_cloudfront_origin_access_control_play.id}"
        },
        "custom_error_response": [
          {
            "error_caching_min_ttl": 3600,
            "error_code": 403,
            "response_code": 404,
            "response_page_path": "/errors/404.html"
          }
        ],
        "enabled": true,
        "default_root_object": "index.html",
        "logging_config": {
          "bucket": "${aws_s3_bucket.aws_s3_bucket_logs.bucket_regional_domain_name}",
          "prefix": "log-sink/cloudfront/play.dinghy.dev/"
        },
        "viewer_certificate": {
          "acm_certificate_arn": "${data.aws_acm_certificate.aws_acm_certificate_dinghydev.arn}",
          "ssl_support_method": "sni-only",
          "minimum_protocol_version": "TLSv1.2_2021"
        }
      },
      "aws_cloudfront_distribution_cdn": {
        "aliases": [
          "cdn.dinghy.dev"
        ],
        "restrictions": {
          "geo_restriction": {
            "restriction_type": "none",
            "locations": []
          }
        },
        "default_cache_behavior": {
          "allowed_methods": [
            "GET",
            "HEAD",
            "OPTIONS"
          ],
          "cached_methods": [
            "GET",
            "HEAD"
          ],
          "target_origin_id": "defaultOrigin",
          "compress": true,
          "viewer_protocol_policy": "redirect-to-https",
          "response_headers_policy_id": "60669652-455b-4ae9-85a4-c4c02393f86c",
          "cache_policy_id": "658327ea-f89d-4fab-a63d-7e88639e58f6"
        },
        "origin": {
          "domain_name": "${aws_s3_bucket.aws_s3_bucket_cdnv1_v1.bucket_regional_domain_name}",
          "origin_id": "defaultOrigin",
          "origin_access_control_id": "${aws_cloudfront_origin_access_control.aws_cloudfront_origin_access_control_cdn.id}"
        },
        "custom_error_response": [
          {
            "error_caching_min_ttl": 3600,
            "error_code": 403,
            "response_code": 404,
            "response_page_path": "/errors/404.html"
          }
        ],
        "enabled": true,
        "default_root_object": "index.html",
        "logging_config": {
          "bucket": "${aws_s3_bucket.aws_s3_bucket_logs.bucket_regional_domain_name}",
          "prefix": "log-sink/cloudfront/cdn.dinghy.dev/"
        },
        "viewer_certificate": {
          "acm_certificate_arn": "${data.aws_acm_certificate.aws_acm_certificate_dinghydev.arn}",
          "ssl_support_method": "sni-only",
          "minimum_protocol_version": "TLSv1.2_2021"
        }
      }
    },
    "aws_route53_record": {
      "aws_route53_record_www": {
        "zone_id": "${data.aws_route53_zone.aws_route53_zone_dinghydev.zone_id}",
        "name": "dinghy.dev",
        "type": "A",
        "alias": {
          "name": "${aws_cloudfront_distribution.aws_cloudfront_distribution_www.domain_name}",
          "zone_id": "${aws_cloudfront_distribution.aws_cloudfront_distribution_www.hosted_zone_id}",
          "evaluate_target_health": false
        }
      },
      "aws_route53_record_play": {
        "zone_id": "${data.aws_route53_zone.aws_route53_zone_dinghydev.zone_id}",
        "name": "play.dinghy.dev",
        "type": "A",
        "alias": {
          "name": "${aws_cloudfront_distribution.aws_cloudfront_distribution_play.domain_name}",
          "zone_id": "${aws_cloudfront_distribution.aws_cloudfront_distribution_play.hosted_zone_id}",
          "evaluate_target_health": false
        }
      },
      "aws_route53_record_cdn": {
        "zone_id": "${data.aws_route53_zone.aws_route53_zone_dinghydev.zone_id}",
        "name": "cdn.dinghy.dev",
        "type": "A",
        "alias": {
          "name": "${aws_cloudfront_distribution.aws_cloudfront_distribution_cdn.domain_name}",
          "zone_id": "${aws_cloudfront_distribution.aws_cloudfront_distribution_cdn.hosted_zone_id}",
          "evaluate_target_health": false
        }
      }
    },
    "aws_cloudfront_origin_access_control": {
      "aws_cloudfront_origin_access_control_www": {
        "name": "dinghy.dev",
        "origin_access_control_origin_type": "s3",
        "signing_behavior": "always",
        "signing_protocol": "sigv4"
      },
      "aws_cloudfront_origin_access_control_play": {
        "name": "play.dinghy.dev",
        "origin_access_control_origin_type": "s3",
        "signing_behavior": "always",
        "signing_protocol": "sigv4"
      },
      "aws_cloudfront_origin_access_control_cdn": {
        "name": "cdn.dinghy.dev",
        "origin_access_control_origin_type": "s3",
        "signing_behavior": "always",
        "signing_protocol": "sigv4"
      }
    },
    "aws_s3_bucket": {
      "aws_s3_bucket_wwwv1_v1": {
        "bucket": "dinghy-website-www-v1"
      },
      "aws_s3_bucket_playv1_v1": {
        "bucket": "dinghy-website-play-v1"
      },
      "aws_s3_bucket_cdnv1_v1": {
        "bucket": "dinghy-website-cdn-v1"
      },
      "aws_s3_bucket_tfstate": {
        "bucket": "dinghy-website-tf-state"
      },
      "aws_s3_bucket_logs": {
        "bucket": "dinghy-website-logs"
      }
    },
    "aws_s3_bucket_logging": {
      "aws_s3_bucket_logging_wwwv1_v1": {
        "bucket": "dinghy-website-www-v1",
        "target_bucket": "dinghy-website-logs",
        "target_prefix": "log-sink/s3/dinghy-website-www-v1/"
      },
      "aws_s3_bucket_logging_playv1_v1": {
        "bucket": "dinghy-website-play-v1",
        "target_bucket": "dinghy-website-logs",
        "target_prefix": "log-sink/s3/dinghy-website-play-v1/"
      },
      "aws_s3_bucket_logging_cdnv1_v1": {
        "bucket": "dinghy-website-cdn-v1",
        "target_bucket": "dinghy-website-logs",
        "target_prefix": "log-sink/s3/dinghy-website-cdn-v1/"
      },
      "aws_s3_bucket_logging_s3bucketlogging": {
        "bucket": "dinghy-website-logs",
        "target_bucket": "dinghy-website-logs",
        "target_prefix": "log-sink/s3/dinghy-website-logs/"
      }
    },
    "aws_s3_bucket_policy": {
      "aws_s3_bucket_policy_wwwv1_v1": {
        "bucket": "dinghy-website-www-v1",
        "policy": "${data.aws_iam_policy_document.aws_iam_policy_document_wwwv1_v1.json}"
      },
      "aws_s3_bucket_policy_playv1_v1": {
        "bucket": "dinghy-website-play-v1",
        "policy": "${data.aws_iam_policy_document.aws_iam_policy_document_playv1_v1.json}"
      },
      "aws_s3_bucket_policy_cdnv1_v1": {
        "bucket": "dinghy-website-cdn-v1",
        "policy": "${data.aws_iam_policy_document.aws_iam_policy_document_cdnv1_v1.json}"
      }
    },
    "aws_s3_bucket_versioning": {
      "aws_s3_bucket_versioning_enableversioning": {
        "bucket": "${aws_s3_bucket.aws_s3_bucket_tfstate.id}",
        "versioning_configuration": {
          "status": "Enabled"
        }
      }
    },
    "aws_s3_bucket_ownership_controls": {
      "aws_s3_bucket_ownership_controls_s3bucketownershipcontrols": {
        "bucket": "dinghy-website-logs",
        "rule": {
          "object_ownership": "BucketOwnerPreferred"
        }
      }
    },
    "aws_s3_bucket_acl": {
      "aws_s3_bucket_acl_s3bucketacl": {
        "bucket": "dinghy-website-logs",
        "acl": "log-delivery-write"
      }
    }
  },
  "data": {
    "aws_iam_policy_document": {
      "aws_iam_policy_document_wwwv1_v1": {
        "statement": {
          "sid": "cloudfront-readonly-access",
          "principals": {
            "type": "Service",
            "identifiers": [
              "cloudfront.amazonaws.com"
            ]
          },
          "actions": [
            "s3:GetObject"
          ],
          "resources": [
            "arn:aws:s3:::dinghy-website-www-v1/*"
          ],
          "condition": {
            "test": "StringEquals",
            "variable": "AWS:SourceArn",
            "values": [
              "${aws_cloudfront_distribution.aws_cloudfront_distribution_www.arn}"
            ]
          }
        }
      },
      "aws_iam_policy_document_playv1_v1": {
        "statement": {
          "sid": "cloudfront-readonly-access",
          "principals": {
            "type": "Service",
            "identifiers": [
              "cloudfront.amazonaws.com"
            ]
          },
          "actions": [
            "s3:GetObject"
          ],
          "resources": [
            "arn:aws:s3:::dinghy-website-play-v1/*"
          ],
          "condition": {
            "test": "StringEquals",
            "variable": "AWS:SourceArn",
            "values": [
              "${aws_cloudfront_distribution.aws_cloudfront_distribution_play.arn}"
            ]
          }
        }
      },
      "aws_iam_policy_document_cdnv1_v1": {
        "statement": {
          "sid": "cloudfront-readonly-access",
          "principals": {
            "type": "Service",
            "identifiers": [
              "cloudfront.amazonaws.com"
            ]
          },
          "actions": [
            "s3:GetObject"
          ],
          "resources": [
            "arn:aws:s3:::dinghy-website-cdn-v1/*"
          ],
          "condition": {
            "test": "StringEquals",
            "variable": "AWS:SourceArn",
            "values": [
              "${aws_cloudfront_distribution.aws_cloudfront_distribution_cdn.arn}"
            ]
          }
        }
      }
    },
    "aws_route53_zone": {
      "aws_route53_zone_dinghydev": {
        "name": "dinghy.dev"
      }
    },
    "aws_acm_certificate": {
      "aws_acm_certificate_dinghydev": {
        "domain": "dinghy.dev"
      }
    }
  }
}
