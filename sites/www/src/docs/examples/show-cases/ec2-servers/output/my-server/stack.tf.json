{
  "provider": {
    "aws": [
      {
        "region": "us-east-1",
        "default_tags": {
          "tags": {
            "iac:stack-title": "My Server",
            "iac:stack-name": "my-server"
          }
        }
      }
    ]
  },
  "terraform": {
    "required_providers": {
      "aws": {
        "source": "aws",
        "version": "6.28.0"
      },
      "local": {
        "source": "local",
        "version": "2.6.1"
      }
    },
    "backend": {
      "local": {
        "path": "stack.tfstate.json"
      }
    }
  },
  "resource": {
    "aws_instance": {
      "awsinstance_myserver": {
        "lifecycle": {
          "ignore_changes": [
            "ami"
          ]
        },
        "ami": "${data.aws_ami.awsami_ami.id}",
        "associate_public_ip_address": true,
        "iam_instance_profile": "${aws_iam_instance_profile.awsiaminstanceprofile_myserverinstanceprofile.name}",
        "instance_type": "t3.nano",
        "subnet_id": "${aws_subnet.awssubnet_myserverpublicasubnet.id}",
        "vpc_security_group_ids": [
          "${aws_security_group.awssecuritygroup_publicwebtraffic.id}"
        ],
        "depends_on": [
          "aws_iam_instance_profile.awsiaminstanceprofile_myserverinstanceprofile",
          "aws_subnet.awssubnet_myserverpublicasubnet",
          "aws_security_group.awssecuritygroup_publicwebtraffic"
        ],
        "tags": {
          "Name": "my-server",
          "iac:id": "awsinstance_myserver"
        }
      }
    },
    "aws_vpc": {
      "awsvpc_myservervpc": {
        "cidr_block": "10.10.0.0/16",
        "tags": {
          "Name": "my-server-vpc",
          "iac:id": "awsvpc_myservervpc"
        }
      }
    },
    "aws_subnet": {
      "awssubnet_myserverpublicasubnet": {
        "vpc_id": "${aws_vpc.awsvpc_myservervpc.id}",
        "availability_zone": "us-east-1a",
        "cidr_block": "10.10.200.0/24",
        "depends_on": [
          "aws_vpc.awsvpc_myservervpc"
        ],
        "tags": {
          "Name": "my-server-public-a-subnet",
          "iac:id": "awssubnet_myserverpublicasubnet"
        }
      }
    },
    "aws_security_group": {
      "awssecuritygroup_publicwebtraffic": {
        "name": "public-web-traffic",
        "vpc_id": "${aws_vpc.awsvpc_myservervpc.id}",
        "depends_on": [
          "aws_vpc.awsvpc_myservervpc"
        ],
        "tags": {
          "Name": "public-web-traffic",
          "iac:id": "awssecuritygroup_publicwebtraffic"
        }
      }
    },
    "aws_vpc_security_group_ingress_rule": {
      "awsvpcsecuritygroupingressrule_allowhttptrafficfromtheinternet": {
        "ip_protocol": "tcp",
        "security_group_id": "${aws_security_group.awssecuritygroup_publicwebtraffic.id}",
        "cidr_ipv4": "0.0.0.0/0",
        "description": "Allow HTTP traffic from the internet",
        "from_port": 80,
        "to_port": 80,
        "depends_on": [
          "aws_security_group.awssecuritygroup_publicwebtraffic"
        ],
        "tags": {
          "Name": "Allow HTTP traffic from the internet",
          "iac:id": "awsvpcsecuritygroupingressrule_allowhttptrafficfromtheinternet"
        }
      },
      "awsvpcsecuritygroupingressrule_allowhttpstrafficfromtheinternet": {
        "ip_protocol": "tcp",
        "security_group_id": "${aws_security_group.awssecuritygroup_publicwebtraffic.id}",
        "cidr_ipv4": "0.0.0.0/0",
        "description": "Allow HTTPS traffic from the internet",
        "from_port": 443,
        "to_port": 443,
        "depends_on": [
          "aws_security_group.awssecuritygroup_publicwebtraffic"
        ],
        "tags": {
          "Name": "Allow HTTPS traffic from the internet",
          "iac:id": "awsvpcsecuritygroupingressrule_allowhttpstrafficfromtheinternet"
        }
      }
    },
    "aws_vpc_security_group_egress_rule": {
      "awsvpcsecuritygroupegressrule_allowalltraffictotheinternet": {
        "ip_protocol": "-1",
        "security_group_id": "${aws_security_group.awssecuritygroup_publicwebtraffic.id}",
        "cidr_ipv4": "0.0.0.0/0",
        "description": "Allow All traffic to the internet",
        "from_port": 0,
        "to_port": 0,
        "depends_on": [
          "aws_security_group.awssecuritygroup_publicwebtraffic"
        ],
        "tags": {
          "Name": "Allow All traffic to the internet",
          "iac:id": "awsvpcsecuritygroupegressrule_allowalltraffictotheinternet"
        }
      }
    },
    "aws_internet_gateway": {
      "awsinternetgateway_myserverinternetgateway": {
        "vpc_id": "${aws_vpc.awsvpc_myservervpc.id}",
        "depends_on": [
          "aws_vpc.awsvpc_myservervpc"
        ],
        "tags": {
          "Name": "my-server-internet-gateway",
          "iac:id": "awsinternetgateway_myserverinternetgateway"
        }
      }
    },
    "aws_default_route_table": {
      "awsdefaultroutetable_myserverdefaultroutetable": {
        "default_route_table_id": "${aws_vpc.awsvpc_myservervpc.default_route_table_id}",
        "depends_on": [
          "aws_vpc.awsvpc_myservervpc"
        ],
        "tags": {
          "Name": "my-server-default-route-table",
          "iac:id": "awsdefaultroutetable_myserverdefaultroutetable"
        }
      }
    },
    "aws_route": {
      "awsroute_route": {
        "route_table_id": "${aws_vpc.awsvpc_myservervpc.default_route_table_id}",
        "destination_cidr_block": "0.0.0.0/0",
        "gateway_id": "${aws_internet_gateway.awsinternetgateway_myserverinternetgateway.id}",
        "depends_on": [
          "aws_vpc.awsvpc_myservervpc",
          "aws_internet_gateway.awsinternetgateway_myserverinternetgateway"
        ]
      }
    },
    "aws_iam_role": {
      "awsiamrole_myserverrole": {
        "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
        "name": "my-server-role",
        "tags": {
          "Name": "my-server-role",
          "iac:id": "awsiamrole_myserverrole"
        }
      }
    },
    "aws_iam_instance_profile": {
      "awsiaminstanceprofile_myserverinstanceprofile": {
        "depends_on": [
          "aws_iam_role.awsiamrole_myserverrole"
        ],
        "role": "my-server-role",
        "tags": {
          "Name": "my-server-instance-profile",
          "iac:id": "awsiaminstanceprofile_myserverinstanceprofile"
        }
      }
    },
    "aws_iam_role_policy_attachment": {
      "awsiamrolepolicyattachment_myserverroleamazonssmmanagedinstancecore": {
        "depends_on": [
          "aws_iam_role.awsiamrole_myserverrole"
        ],
        "policy_arn": "arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore",
        "role": "my-server-role"
      }
    },
    "local_file": {
      "localfile_myserverstackjson": {
        "filename": "my-server.stack.json",
        "content": "{\n  \"awsinstance_myserver_output\": {\n    \"Name\": \"my-server\",\n    \"InstanceId\": \"${aws_instance.awsinstance_myserver.id}\",\n    \"PublicIp\": \"${aws_instance.awsinstance_myserver.public_ip}\",\n    \"Region\": \"${aws_instance.awsinstance_myserver.region}\"\n  }\n}",
        "depends_on": [
          "aws_instance.awsinstance_myserver"
        ]
      }
    }
  },
  "output": {
    "awsinstance_myserver_output": {
      "value": "{\"Name\":\"my-server\",\"InstanceId\":\"${aws_instance.awsinstance_myserver.id}\",\"PublicIp\":\"${aws_instance.awsinstance_myserver.public_ip}\",\"Region\":\"${aws_instance.awsinstance_myserver.region}\"}",
      "description": "Output of my-server",
      "depends_on": [
        "aws_instance.awsinstance_myserver"
      ]
    }
  },
  "data": {
    "aws_ami": {
      "awsami_ami": {
        "filter": [
          {
            "name": "architecture",
            "values": [
              "x86_64"
            ]
          }
        ],
        "most_recent": true,
        "name_regex": "^al2023-ami-\\d{4}.*",
        "owners": [
          "amazon"
        ]
      }
    }
  }
}
